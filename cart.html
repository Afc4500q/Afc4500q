<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>سلة المنتجات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      color: #333;
      margin: 0;
      padding: 0;
    }

    .cart-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 50px;
    }

    .cart-item {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }

    .cart-item p {
      margin: 5px 0;
    }

    .cart-item input {
      padding: 5px;
      width: 60px;
      margin-top: 5px;
    }

    .cart-item button {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      margin-top: 10px;
    }

    .cart-item button:hover {
      background-color: #c0392b;
    }

    .send-to-telegram {
      background-color: #2ecc71;
      color: white;
      padding: 10px 20px;
      border: none;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
    }

    .send-to-telegram:hover {
      background-color: #27ae60;
    }

    .customer-info {
      margin-top: 30px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 5px;
    }

    .customer-info label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .customer-info input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .back-button {
      display: inline-block;
      background-color: #3498db;
      color: white;
      padding: 10px 15px;
      text-decoration: none;
      border-radius: 5px;
      margin-top: 20px;
    }

    .back-button:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>
  <div class="cart-container" id="cartContainer">
    <!-- سلة المنتجات ستظهر هنا -->
  </div>

  <div class="customer-info">
    <h3>معلومات الزبون</h3>
    <label for="customerName">الاسم الثلاثي</label>
    <input type="text" id="customerName" placeholder="الاسم الثلاثي" />

    <label for="customerPhone">رقم الهاتف</label>
    <input type="text" id="customerPhone" placeholder="رقم الهاتف" />

    <label for="customerGovernorate">المحافظة</label>
    <input type="text" id="customerGovernorate" placeholder="المحافظة" />

    <label for="customerCity">المدينة</label>
    <input type="text" id="customerCity" placeholder="المدينة" />

    <label for="customerRegion">المنطقة</label>
    <input type="text" id="customerRegion" placeholder="المنطقة" />

    <label for="salePrice">سعر البيع</label>
    <input type="text" id="salePrice" placeholder="سعر البيع" />

    <button class="send-to-telegram" onclick="sendToTelegram()">إرسال إلى بوت تيليجرام</button>
  </div>

  <a href="products.html" class="back-button">الرجوع إلى صفحة المنتجات</a>

  <script>
    // دالة لعرض السلة
    function displayCart() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const cartContainer = document.getElementById("cartContainer");
      cartContainer.innerHTML = ''; // مسح محتويات السلة الحالية

      cart.forEach(product => {
        const productDiv = document.createElement("div");
        productDiv.classList.add("cart-item");
        productDiv.innerHTML = `
          <p>اسم المنتج: ${product.name}</p>
          <p>السعر: ${product.minPrice} دينار</p>
          <p>رابط الصورة: ${product.image}</p>
          <p>الكمية: <input type="number" id="quantity${product.id}" value="1" min="1" /></p>
          <button onclick="removeFromCart(${product.id})">حذف المنتج</button>
        `;
        cartContainer.appendChild(productDiv);
      });
    }

    // دالة لحذف المنتج من السلة
    function removeFromCart(productId) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart = cart.filter(product => product.id !== productId);
      localStorage.setItem("cart", JSON.stringify(cart));
      displayCart();
    }

    // دالة إرسال البيانات إلى بوت تيليجرام
    function sendToTelegram() {
      const customerName = document.getElementById("customerName").value;
      const customerPhone = document.getElementById("customerPhone").value;
      const customerGovernorate = document.getElementById("customerGovernorate").value;
      const customerCity = document.getElementById("customerCity").value;
      const customerRegion = document.getElementById("customerRegion").value;
      const salePrice = document.getElementById("salePrice").value;

      if (!customerName || !customerPhone || !customerGovernorate || !customerCity || !customerRegion || !salePrice) {
        alert("يرجى ملء جميع الحقول.");
        return;
      }

      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (cart.length === 0) {
        alert("السلة فارغة!");
        return;
      }

      const userId = JSON.parse(localStorage.getItem("userData")).id || "غير معروف"; // استرجاع ID الحساب

      let message = `معلومات الزبون:\n`;
      message += `الاسم: ${customerName}\n`;
      message += `رقم الهاتف: ${customerPhone}\n`;
      message += `المحافظة: ${customerGovernorate}\n`;
      message += `المدينة: ${customerCity}\n`;
      message += `المنطقة: ${customerRegion}\n`;
      message += `سعر البيع: ${salePrice} دينار\n`;
      message += `ID الحساب: ${userId}\n\n`;  // إضافة الـ ID في الرسالة
      message += "تفاصيل سلة المنتجات:\n\n";

      // إضافة تفاصيل كل منتج في السلة
      cart.forEach(product => {
        const quantity = document.getElementById("quantity" + product.id).value || 1; // التأكد من الحصول على الكمية المدخلة
        message += `اسم المنتج: ${product.name}\n`;
        message += `السعر: ${product.minPrice} دينار\n`;
        message += `رابط الصورة: ${product.image}\n`;
        message += `الكمية: ${quantity}\n\n`; // أضف الكمية إلى الرسالة
      });

      const botToken = "7571233461:AAH8lJsUeuKV_L57A42C6pE5i7FFi1_LIak";  // توكن البوت
      const chatId = "1434047374";  // معرف الدردشة
      const telegramApiUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;

      // إرسال البيانات إلى بوت تيليجرام
      fetch(telegramApiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          chat_id: chatId,
          text: message
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          alert("تم إرسال سلة المنتجات إلى بوت تيليجرام!");
          localStorage.removeItem("cart");  // حذف المنتجات من السلة
          displayCart();  // إعادة عرض السلة (تكون فارغة الآن)
          document.querySelector('.send-to-telegram').style.display = 'none'; // إخفاء زر الإرسال بعد النجاح
        } else {
          alert("حدث خطأ أثناء إرسال الرسالة.");
        }
      })
      .catch(error => {
        alert("حدث خطأ أثناء إرسال الرسالة.");
        console.error(error);
      });
    }

    // عند تحميل الصفحة، عرض السلة
    window.onload = function() {
      displayCart();
    };
  </script>
</body>
</html>
