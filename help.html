<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update User</title>
</head>
<body>
    <h1>Update User by Username</h1>
    <form id="updateForm">
        <label for="username">Username to Update:</label>
        <input type="text" id="username" required><br><br>

        <label for="newUsername">New Username:</label>
        <input type="text" id="newUsername"><br>

        <label for="newPassword">New Password:</label>
        <input type="text" id="newPassword"><br>

        <label for="newName">New Name:</label>
        <input type="text" id="newName"><br>

        <label for="newBalance">New Balance:</label>
        <input type="number" id="newBalance"><br>

        <label for="newSuccessfulOrders">New Successful Orders:</label>
        <input type="number" id="newSuccessfulOrders"><br>

        <label for="newPendingOrders">New Pending Orders:</label>
        <input type="number" id="newPendingOrders"><br><br>

        <button type="button" id="updateButton">Update User</button>
    </form>

    <script>
        const apiUrl = 'https://673a394a339a4ce445179ae7.mockapi.io/User';

        async function fetchUserByUsername(username) {
            try {
                const response = await fetch(`${apiUrl}?username=${username}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch user');
                }
                const users = await response.json();
                if (users.length === 0) {
                    alert('User not found');
                    return null;
                }
                return users[0]; // Assume username is unique
            } catch (error) {
                console.error('Error fetching user:', error);
                return null;
            }
        }

        async function updateUserByUsername() {
            const username = document.getElementById('username').value;
            if (!username) {
                alert('Please enter a username to update.');
                return;
            }

            const updatedData = {
                username: document.getElementById('newUsername').value,
                password: document.getElementById('newPassword').value,
                name: document.getElementById('newName').value,
                balance: parseFloat(document.getElementById('newBalance').value),
                successfulOrders: parseInt(document.getElementById('newSuccessfulOrders').value, 10),
                pendingOrders: parseInt(document.getElementById('newPendingOrders').value, 10),
            };

            const user = await fetchUserByUsername(username);
            if (!user) {
                alert('Cannot update: User not found');
                return;
            }

            try {
                const response = await fetch(`${apiUrl}/${user.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedData),
                });

                if (!response.ok) {
                    throw new Error(`Failed to update user: ${response.statusText}`);
                }

                const result = await response.json();
                alert('User updated successfully!');
                console.log('Updated user:', result);
            } catch (error) {
                console.error('Error updating user:', error);
                alert('An error occurred while updating the user.');
            }
        }

        document.getElementById('updateButton').addEventListener('click', updateUserByUsername);
    </script>
</body>
</html>
