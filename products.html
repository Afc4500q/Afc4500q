<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
   <link rel="stylesheet" href="p.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منتجات عشتار</title>
  <style>
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <h1>عشتار</h1>
    <nav>
      <button onclick="window.location.href='account.html'">الحساب</button>
      <button onclick="window.location.href='cart.html'">سلة المنتجات</button>
      <button onclick="window.location.href='support.html'">الدعم الفني</button>
    </nav>
  </header>

  <!-- Products Section -->
  <div class="products-container" id="productsContainer">
    <!-- المنتجات سيتم إضافتها هنا عبر JavaScript -->
    <!-- زر "بيع لزبون" -->


<!-- نافذة منبثقة (Modal) -->
<div id="customerModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3>معلومات الزبون</h3>
    <form id="customerForm">
      <label for="customerName">الاسم الثلاثي:</label>
      <input type="text" id="customerName" required>
      
      <label for="phoneNumber">رقم الهاتف:</label>
      <input type="text" id="phoneNumber" required>

      <label for="province">المحافظة:</label>
      <input type="text" id="province" required>

      <label for="city">المدينة:</label>
      <input type="text" id="city" required>

      <label for="region">المنطقة:</label>
      <input type="text" id="region" required>

      <button type="submit">إرسال</button>
    </form>
  </div>
</div>
  </div>

  <script>
    // جلب المنتجات من الـ API
    async function fetchProducts() {
      try {
        const response = await fetch("https://673a0d78a3a36b5a62f0945e.mockapi.io/products/api/products");
        if (response.ok) {
          const products = await response.json();
          displayProducts(products);
        } else {
          console.error("فشل في تحميل المنتجات");
        }
      } catch (error) {
        console.error("حدث خطأ عند جلب البيانات:", error);
      }
    }

    // عرض المنتجات في الصفحة
    function displayProducts(products) {
      const productsContainer = document.getElementById("productsContainer");
      productsContainer.innerHTML = "";  // تفريغ الحاوية قبل إضافة المنتجات الجديدة

      products.forEach(product => {
        const productCard = document.createElement("div");
        productCard.classList.add("product-card");

        // إضافة محتوى المنتج
        productCard.innerHTML = `
          <img src="${product.image}" alt="${product.name}">
          <h3 id="product-name-${product.id}">${product.name}</h3>
          <p>سعر أدنى: ${product.minprice} </p>
          <p>سعر أعلى: ${product.maxprice} </p>
          <button onclick="addToCart('${product.id}')">إضافة إلى السلة</button>
          <button id="sellToCustomerBtn">بيع لزبون</button>
        `;
        
        productsContainer.appendChild(productCard);
      });
    }

    // إضافة المنتج إلى السلة
    function addToCart(productId) {
      // جلب المنتجات المخزنة في السلة من localStorage
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      // جلب بيانات المنتج بناءً على المعرف
      const productName = document.querySelector(`#product-name-${productId}`).innerText;
      const productMinPrice = document.querySelector(`#product-name-${productId}`).nextElementSibling.innerText.split(':')[1].trim();
      const productMaxPrice = document.querySelector(`#product-name-${productId}`).nextElementSibling.nextElementSibling.innerText.split(':')[1].trim();

      const product = {
        id: productId,
        name: productName,
        minPrice: productMinPrice,
        maxPrice: productMaxPrice
      };

      // إضافة المنتج إلى السلة
      cart.push(product);

      // تخزين السلة مرة أخرى في localStorage
      localStorage.setItem("cart", JSON.stringify(cart));

      console.log(`تم إضافة المنتج ${productId} إلى السلة`);
    }

    // بيع المنتج لزبون (يمكن تطويره لاحقًا)
    // فتح نافذة منبثقة عند الضغط على زر "بيع لزبون"
const sellToCustomerBtn = document.getElementById("sellToCustomerBtn");
const customerModal = document.getElementById("customerModal");
const closeModal = document.querySelector(".close");

// إظهار النافذة عند الضغط على الزر
sellToCustomerBtn.onclick = function() {
  customerModal.style.display = "block";
}

// إغلاق النافذة عند الضغط على الـ X
closeModal.onclick = function() {
  customerModal.style.display = "none";
}

// إغلاق النافذة إذا تم النقر في أي مكان خارج النافذة
window.onclick = function(event) {
  if (event.target == customerModal) {
    customerModal.style.display = "none";
  }
}

// إرسال البيانات إلى بوت تيلجرام
document.getElementById("customerForm").addEventListener("submit", async function(event) {
  event.preventDefault(); // منع إعادة تحميل الصفحة

  const customerName = document.getElementById("customerName").value;
  const phoneNumber = document.getElementById("phoneNumber").value;
  const province = document.getElementById("province").value;
  const city = document.getElementById("city").value;
  const region = document.getElementById("region").value;

  // الحصول على ID المستخدم من التخزين المحلي أو أي مكان آخر حيث تم تخزينه
  const userId = localStorage.getItem("userId"); // مثال باستخدام localStorage

  const message = `
    اسم الزبون: ${customerName}
    رقم الهاتف: ${phoneNumber}
    المحافظة: ${province}
    المدينة: ${city}
    المنطقة: ${region}
    ID المستخدم: ${userId}
  `;

  // إرسال البيانات إلى بوت تيلجرام
  const botToken = '7571233461:AAH8lJsUeuKV_L57A42C6pE5i7FFi1_LIak';
  const chatId = '1434047374';
  const telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;

  const response = await fetch(telegramUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      chat_id: chatId,
      text: message,
    }),
  });

  if (response.ok) {
    alert('تم إرسال المعلومات بنجاح!');
    customerModal.style.display = "none"; // إغلاق النافذة
  } else {
    alert('حدث خطأ أثناء إرسال المعلومات.');
  }
});

    // استدعاء دالة جلب المنتجات عند تحميل الصفحة
    fetchProducts();
  </script>

</body>
</html>
